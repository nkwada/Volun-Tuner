<h4>Pick Up</h4>

<div class="row">
	<% @event_randoms.each do |event| %>
		<div class="col-4">
			<div class="card border-success">
			  <div class="card-header bg-success text-white">
			    <%= event.title %>
			  </div>

			  <div class="card-body">
			  	<ul>
				  <li>開催日時：<%= event.start_time.strftime("%Y年%m月%d日 %H:%M") %></li>
				  <li>集合場所：<%= event.address %></li>
				  <li>いいね数：<%= event.liked_users.count %></li>
				  <li>参加人数：<%= event.joined_users.count %></li>
				  <li>主催者：<%= event.user.username %></li>
				  <li><%= render 'events/tag_list', tag_list: event.tag_list %></li>
				</ul>
			  </div>

			</div>
			<div class="text-right">
				<%= link_to "詳細をみる", event, class: "btn btn-sm btn-secondary mt-2" %>
			</div>
		</div>
	<% end %>
</div>

<hr>


<h4>ボランティアを探す</h4>

<div class="row">
	<div class="col-4">
		<div class="card text-center">
		  <div class="card-header">
		    新着順に全件表示
		  </div>
		  <div class="card-body">
		  	<%= link_to "ボランティアを見る", events_search_path, class: "btn btn-primary rounded-pill" %>
		  </div>
		</div>
	</div>
	<div class="col-8">
		<div class="card text-center">
		  <div class="card-header">
		    フリーワード検索
		  </div>
		  <div class="card-body">
				<!-- 検索フォームの表示 -->
				<%= form_with url:events_search_path, :method => 'get', local: true do |f| %>
					<%= f.select :selected, [['タイトル','Title'],['内容','Content']] %>
				 	<%= f.search_field :search, :size=>"40" %>
				  	<%= f.submit 'Search', name: nil %>
				<% end %>
				<!-- ここまで -->
		  </div>
		</div>
	</div>
</div>

<hr>

<div class="row">
	<div class="col-4">
		<div class="card text-center">
		  <div class="card-header">
		    現在地から近い順に表示
		  </div>
		  <div class="card-body">
		　	<button onclick="getPosition();" class="btn btn-warning">現在地から探す</button>
		  </div>
		</div>
	</div>

	<div class="col-8">
		<div class="card text-center">
		  <div class="card-header">
		    タグで検索
		  </div>
		  <div class="card-body">
			<!-- タグ検索 -->
			<%= link_to "テスト", events_search_path(tag_name: "テスト"), class: "btn-sm btn-info" %>
			<%= link_to "テスト", events_search_path(tag_name: "テスト"), class: "btn-sm btn-info" %>
			<%= link_to "テスト", events_search_path(tag_name: "テスト"), class: "btn-sm btn-info" %>
			<%= link_to "テスト", events_search_path(tag_name: "テスト"), class: "btn-sm btn-info" %>
			<!-- ここまで -->
		  </div>
		</div>
	</div>
</div>

<hr>


<!-- イベント全てをカレンダーに表示 -->
<%= month_calendar events: @events do |date, events| %>
  <%= date.day %>
  <!-- 切り替えボタンの設定 -->
	<div class="text-center"><button type="button" class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#eventModalLong-<%= date.day %>">
	 <%= events.count %>件
	</button></div>

<!-- モーダルの設定 -->
<div class="modal fade" id="eventModalLong-<%= date.day %>" tabindex="-1" role="dialog" aria-labelledby="eventModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="eventModalLongTitle"><%= date.day %>日のボランティア全件</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="閉じる">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      	<ul>
      	<% events.each do |event| %>
      		<li><%= link_to event.title, event %></li>
      	<% end %>
      	</ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">閉じる</button>
      </div>
    </div>
  </div>
</div>

<% end %>
<!-- ここまで -->







<!-- 現在地取得の記述 -->
<script>
    // 現在地取得処理
    function getPosition() {
      // 現在地を取得
      navigator.geolocation.getCurrentPosition(
        // 取得成功した場合
        function(position) {
            window.location.href = "/events/search?latitude="+position.coords.latitude+"&longitude="+position.coords.longitude
            // $.ajax({
            //   url: "/events/search_location",
            //   type: "GET",
            //   dataType: 'html',
            //   data: {latitude : position.coords.latitude,
            //         longitude : position.coords.longitude},
            // });
        },
        // 取得失敗した場合
        function(error) {
          switch(error.code) {
            case 1: //PERMISSION_DENIED
              alert("位置情報の利用が許可されていません");
              break;
            case 2: //POSITION_UNAVAILABLE
              alert("現在位置が取得できませんでした");
              break;
            case 3: //TIMEOUT
              alert("タイムアウトになりました");
              break;
            default:
              alert("その他のエラー(エラーコード:"+error.code+")");
              break;
          }
        }
      );
    }
  </script>